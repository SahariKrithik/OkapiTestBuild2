<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Unity WebGL Header Debug</title>
  <style>
    body { font-family: monospace; padding: 20px; background: #111; color: #eee; }
    h1 { color: #fff; }
    table { border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #555; padding: 8px 12px; }
    th { background: #222; }
    .ok { color: #0f0; font-weight: bold; }
    .fail { color: #f33; font-weight: bold; }
  </style>
</head>
<body>
  <h1>Unity WebGL Header Debug</h1>
  <div id="output">Checking...</div>

  <script>
    const expected = {
      "framework.js.br": { "content-type": "application/javascript", "content-encoding": "br" },
      "data.br": { "content-type": "application/octet-stream", "content-encoding": "br" },
      "wasm.br": { "content-type": "application/wasm", "content-encoding": "br" }
    };

    async function checkFile(file) {
      try {
        const response = await fetch("Build/" + file);
        const headers = {};
        response.headers.forEach((val, key) => headers[key.toLowerCase()] = val);
        return { file, headers, ok: true };
      } catch (err) {
        return { file, ok: false, error: err.toString() };
      }
    }

    function compareHeaders(file, headers) {
      const checks = [];
      const rules = Object.entries(expected).find(([k]) => file.includes(k));
      if (!rules) return [];
      const [_, expectedHeaders] = rules;

      for (const [key, exp] of Object.entries(expectedHeaders)) {
        const got = headers[key];
        if (got && got.trim() === exp) {
          checks.push(`<td class="ok">✅ ${key}: ${got}</td>`);
        } else {
          checks.push(`<td class="fail">❌ ${key}: ${got || "missing"} (expected: ${exp})</td>`);
        }
      }
      return checks;
    }

    async function run() {
      const files = [
        "TestBuildOkapi.framework.js.br",
        "TestBuildOkapi.data.br",
        "TestBuildOkapi.wasm.br"
      ];
      const results = await Promise.all(files.map(checkFile));
      let html = "<table><tr><th>File</th><th>Content-Type</th><th>Content-Encoding</th></tr>";

      for (const r of results) {
        if (!r.ok) {
          html += `<tr><td>${r.file}</td><td colspan="2" class="fail">❌ Error: ${r.error}</td></tr>`;
        } else {
          const checks = compareHeaders(r.file, r.headers);
          html += `<tr><td>${r.file}</td>${checks.join("")}</tr>`;
        }
      }

      html += "</table>";
      document.getElementById("output").innerHTML = html;
    }

    run();
  </script>
</body>
</html>
